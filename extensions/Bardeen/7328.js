"use strict";(self.webpackChunkbardeen_browser_extension=self.webpackChunkbardeen_browser_extension||[]).push([[7328],{74392:(e,t,n)=>{n.d(t,{i:()=>c});var o=n(2784),a=n(68796),s=n(78975),i=n(62774),r=n(55567),l=n(34005);function c({onAfterDelete:e=(()=>{})}){const[t,n]=o.useState(null),[,{openSnackbar:c}]=(0,l.E0)(),u=o.useCallback((()=>n(null)),[n]),p=o.useCallback((()=>{t&&r.Z.dedangle(r.Z.playbookDelete(t.id).then(e).catch((e=>{c({message:`Could not delete playbook: ${(0,a.unknownToString)(e)}`,variant:"error"})})).finally((()=>{n(null)})))}),[t,c,e]);return[o.useMemo((()=>o.createElement(s.BardeenModal,{open:!!t,title:"Delete",primaryButton:"Ok",secondaryButton:"Cancel",footerVariant:"buttons",secondaryCallback:u,primaryCallback:p},o.createElement(i.Z,{mt:2},"Are you sure you want to delete ",o.createElement("strong",null,t?t.name:null),"? This action cannot be undone!"))),[u,p,t]),n]}},5578:(e,t,n)=>{n.d(t,{d:()=>l});var o=n(2784),a=n(55567),s=n(78975),i=n(68796),r=n(34005);function l(){const[,{openSnackbar:e}]=(0,r.E0)(),t=o.useRef(""),[n,l]=o.useState(!1),[c,u]=o.useState(!1),[p,d]=o.useState(!1),[g,m]=o.useState({editable:!1,instructions:"",shareId:"",shareUrl:"",created:!1}),h=o.useCallback((n=>{t.current=n,m({editable:!1,instructions:"",shareId:"",shareUrl:"Publishing playbook ...",created:!1}),d(!0),l(!0),u(!1),a.Z.playbookSharingGet(n).then((t=>{if(t)return m(t),u(t.editable),void d(!1);a.Z.playbookSharingUpdate(n,{}).then((e=>{m(e),u(e.editable),d(!1)})).catch((t=>{e({variant:"error",description:`Could not share this playbook: ${(0,i.unknownToString)(t)}`}),l(!1)}))})).catch((t=>{e({variant:"error",description:`Could not get the current sharing status of the playbook: ${(0,i.unknownToString)(t)}`}),l(!1)}))}),[e]),b=o.useCallback((()=>{l(!1)}),[]),f=o.useCallback((()=>{t.current&&(d(!0),a.Z.playbookSharingRevoke(t.current).then((()=>{d(!1),l(!1)})).catch((t=>{d(!1),e({variant:"error",description:`Could not unshare playbook: ${(0,i.unknownToString)(t)}`})})))}),[e]),k=o.useCallback((n=>{t.current&&(d(!0),a.Z.playbookSharingUpdate(t.current,n).then((e=>{m(e),d(!1),l(!1)})).catch((t=>{d(!1),e({variant:"error",description:`Could not update sharing details: ${(0,i.unknownToString)(t)}`})})))}),[e]);return[o.useMemo((()=>o.createElement(s.PlaybookShareModal,{editable:c,loading:p,onClose:b,onDelete:f,onCommit:k,open:n,sharingInfo:g})),[n,p,g,c,b,f,k]),h]}},58081:(e,t,n)=>{n.d(t,{OA:()=>l,LR:()=>c,hB:()=>u,hZ:()=>d,uU:()=>p,yE:()=>g});var o=n(2784),a=(n(68796),n(78975)),s=n(61454);const i=a.MetricsMap.boxModel.spacing,r=(0,s.createUseStyles)({checkboxWrapper:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:`${i.m}px`}}),l=e=>{const{config:t,value:n,onChange:s}=e,i=r();return o.createElement("div",{className:i.checkboxWrapper},o.createElement(a.BardeenCheckboxV2,{checked:n,onChange:s,label:t.label||t.name}))},c=e=>{const{value:t,onChange:n,config:s}=e,{minValue:i,maxValue:r}=s.widget,l=o.useCallback((e=>{const t=Number(e);isNaN(t)||(null!=i&&t<i&&(e=String(i)),null!=r&&t>r&&(e=String(r))),n(e)}),[r,i,n]);return o.createElement(a.BardeenFormItem,{labelText:s.label||s.name,labelAlign:"left"},o.createElement(a.BardeenInput,{type:"number",value:t,onChange:l}))},u=e=>{const{value:t,config:n,onChange:s}=e;return o.createElement(a.BardeenFormItem,{labelText:n.label||n.name,labelAlign:"left"},o.createElement(a.BardeenInput,{type:"password",value:t,onChange:s}))},p=e=>{const{value:t,config:n,onChange:s}=e,i=n.widget,{options:r}=i;return o.createElement(a.BardeenFormItem,{labelText:n.label||n.name,labelAlign:"left"},o.createElement(a.BardeenSelect,{onChange:s,value:t,options:r}))},d=e=>{const{value:t,config:n,onChange:s}=e,i=n.widget,{options:r}=i;return o.createElement(a.BardeenFormItem,{labelText:n.label||n.name,labelAlign:"left"},o.createElement(a.BardeenSelect,{multiple:!0,onChange:s,value:t,placeholder:i.placeholder,options:r}))},g=e=>{const{value:t,config:n,onChange:s}=e;return o.createElement(a.BardeenFormItem,{labelText:n.label||n.name,labelAlign:"left"},o.createElement(a.BardeenInput,{value:t,onChange:s}))}},1740:(e,t,n)=>{n.d(t,{P:()=>G});var o=n(2784),a=n(79692),s=n(55567),i=n(6277),r=n(69378),l=n.n(r),c=n(68796),u=n(78975);class p{constructor(e=100,t=200){this.blockTs=0,this.typingInterval=1/(t/60)*1e3,this.minInterval=e}cancel(){this.blockTs=0,delete this.scheduledFn,this.timer&&window.clearTimeout(this.timer)}fire(){return this.cancel(),this.scheduledFn?this.scheduledFn():Promise.resolve()}debounce(e,t=!1){if(this.blockTs||(this.blockTs=Date.now()),this.cancel(),this.isDelete&&!t)return this.isDelete=t,this.blockTs=0,void e();const n=Date.now()-this.blockTs,o=t?this.typingInterval:Math.max(0,Math.min(this.minInterval-n,this.typingInterval));this.isDelete=t,this.timer=window.setTimeout((()=>{this.blockTs=0,delete this.scheduledFn,e()}),o)}}var d=n(34005);const g=e=>{const{block:t,onNotebookChanged:n}=e,[a,i]=o.useState(e.defaultExpanded),[,{openSnackbar:r}]=(0,d.E0)();return o.createElement(u.VisualBlock,{block:t,bodyExpanded:a,onInteract:e=>{return t=void 0,o=void 0,i=function*(){try{const t=yield s.Z.notebookVisualBlockInteract(e);return n?n(t):null}catch(e){r({variant:"error",description:(0,c.unknownToString)(e)})}},new((a=void 0)||(a=Promise))((function(e,n){function s(e){try{l(i.next(e))}catch(e){n(e)}}function r(e){try{l(i.throw(e))}catch(e){n(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(s,r)}l((i=i.apply(t,o||[])).next())}));var t,o,a,i},onToggleBody:()=>i(!a)})},m=u.MetricsMap.boxModel.spacing,h=(0,a.Z)({actionsSection:Object.assign(Object.assign({marginRight:`${m.base}px`},u.center),{alignItems:"center",justifyContent:"center"}),headerContainer:{padding:`${m.m-1}px ${m.m}px `,display:"flex",justifyContent:"space-between",backgroundColor:u.ColorMap.base.white},headerButtons:{borderRadius:`${m.m}px`,marginLeft:`${m.s}px`},iconButton:{marginRight:".5rem"},buttonWrapper:Object.assign(Object.assign({},u.center),{padding:`${m.m}px 0`,marginBottom:`${m.m}px`}),marginRight:{marginRight:`${m.s}px`}}),b=e=>{const{blocks:t,onNotebookChanged:n,isLast:a,entry:s,quickActions:i,onCloseResultsScreen:r,onRepeat:l}=e,[c,p]=o.useState(10),d=h(),m=o.createElement(o.Fragment,null,s?o.createElement("div",{className:d.headerContainer},o.createElement(u.BardeenActionItemHeader,{icons:(null==s?void 0:s.pluginIcons)||[],isDark:!1,inputTokens:(null==s?void 0:s.userInputTokens)||[]}),o.createElement("div",{"data-testid":"vbg-actionsection",className:d.actionsSection},0===(null==i?void 0:i.length)?null:null==i?void 0:i.map(((e,t)=>o.createElement("div",{key:t},e))),o.createElement(u.BardeenButton,{"data-testid":"vbg-repeat",className:d.headerButtons,icon:{icon:"RepeatRoundOutline"},size:"s",rounded:!0,type:"neumorphOutline",onClick:e=>{e.preventDefault(),l&&l()}}),o.createElement(u.BardeenButton,{"data-testid":"vbg-close",icon:{icon:"CrossOutline"},size:"s",rounded:!0,type:"neumorphOutline",onClick:e=>{e.preventDefault(),r&&r()},className:d.headerButtons}))):null),b=t.slice(0,c).map(((e,s)=>o.createElement("div",{key:s},a?m:null,o.createElement(g,{"data-testid":"vbg-block",block:e,defaultExpanded:t.length<4,onNotebookChanged:n})))),f=t.some((e=>e.hasOwnProperty("messageContent")))?t.length-1:t.length;return c<t.length&&b.push(o.createElement("div",{key:"more",className:d.buttonWrapper},o.createElement(u.BardeenButton,{className:d.marginRight,type:"neumorphOutline",size:"m","data-testid":"vbg-showmore",onClick:e=>{e.preventDefault(),e.stopPropagation();const n=t.length,o=c+10;p(o>n?n:o)}},"Show more items"),f>0?o.createElement(u.BardeenButton,{type:"neumorphOutline",size:"m","data-testid":"vbg-showall",onClick:e=>{e.preventDefault(),e.stopPropagation();const n=t.length;p(n)}},"Show all ",f," entries"):null)),b},f=o.memo((e=>{const{entries:t,isDark:n,getQuickActions:a,onInputStateChanged:i,onNotebookChanged:r,closeResults:l}=e,c=e=>o.createElement(b,{blocks:e.blocks,onNotebookChanged:r});return o.createElement("div",null,t&&t.length>0?t.map(((e,p)=>{t.length;const d=a?a(e):[];return o.createElement(o.Fragment,{key:"notebookEntry-"+e.uuid},o.createElement(u.NotebookAction,{key:"action-"+e.uuid,isDark:n,appEditMode:!1,faint:!1,onRepeat:()=>{s.Z.notebookCommandRecall(e.uuid).then((e=>{i(e),l&&l()}))},onDelete:()=>s.Z.notebookCommandDelete(e.uuid).then(r),quickActions:d,defaultOpen:0===p,notebookEntry:{inputTokens:e.userInputTokens,body:o.createElement("div",null,c(e)),uuid:e.uuid,pluginIcons:e.pluginIcons}}))})):null)}),((e,t)=>{return e.changeIndicator==t.changeIndicator&&(((n=e.entries)===(o=t.entries)||null!=n&&null!=o&&n.length===o.length&&!n.some(((e,t)=>e.uuid!==o[t].uuid)))&&e.getQuickActions===t.getQuickActions);var n,o}));const k=e=>{const{highlightAll:t,clipboardContext:n,inputTokens:a,onClear:s,onInputTextChange:i,onKeyDown:r,onPaste:l,onTokensChange:p,onTabChange:d,pbHeaderProps:g}=e,m=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n}(e,["highlightAll","clipboardContext","inputTokens","onClear","onInputTextChange","onKeyDown","onPaste","onTokensChange","onTabChange","pbHeaderProps"]),[h,b]=o.useState(!1),f=o.useCallback((e=>{if(!h)return;e.preventDefault(),e.stopPropagation();const t=a.map((e=>e.type===c.CommandInput.TokenType.Rendered?e.label:e.value)).join(" "),o=a.map(((e,t)=>{const{itemColor:o,textColor:a}=(0,u.getTokenColors)(e.color),s=e.type===c.CommandInput.TokenType.Rendered?e.label:e.value;return`<span data-bardeen-context="${n}" data-token="${btoa(JSON.stringify(e))}" style="color: ${a}; background-color: ${o}; padding: 4px; border-radius: 4px;${t>0?" margin-left: 2px;":""}">${s}</span>`})).join(" "),s=globalThis.ClipboardItem;if(s&&navigator.clipboard.write){const e=`<span data-bardeen-version="2">${o}<span>&nbsp;</span></span>`,n=[new s({"text/plain":new Blob([t],{type:"text/plain"}),"text/html":new Blob([e],{type:"text/html"})})];navigator.clipboard.write(n)}else navigator.clipboard.writeText(t)}),[a,h,n]),k=o.useCallback((e=>{const t=e.clipboardData.getData("text/html");if(t){let o;if(null==(o=/data-bardeen-context="(.*?)"/g.exec(t)))return;{const t=o[1];if(t!=n)return console.warn(`Refusing to paste: Cannot paste data from context '${t}' to context '${n}'`),e.preventDefault(),void e.stopPropagation()}const a=[],s=/data-token="(.*?)"/g;let i="";for(;null!=(o=s.exec(t));){i=o[1];const e=JSON.parse(atob(i));a.push(e)}i.length>0&&(b(!1),p(a,"append"),e.preventDefault(),e.stopPropagation())}}),[n,p,b]),v=o.useCallback((e=>{if(h){if(["ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Escape"].includes(e.key))return b(!1),e.preventDefault(),void e.stopPropagation();if("C"===e.key.toUpperCase()&&(e.ctrlKey||e.metaKey))return f(e),e.preventDefault(),void e.stopPropagation();if("X"===e.key.toUpperCase()&&(e.ctrlKey||e.metaKey))return f(e),p([],"delete"),e.preventDefault(),void e.stopPropagation();(function(e){return!e.ctrlKey&&!e.metaKey&&!e.altKey&&/[ a-z\d\[\\\]';=,\-.\/`]/i.test(e.key)})(e)&&(b(!1),p([],"delete"))}else if("A"===e.key.toUpperCase()&&(e.ctrlKey||e.metaKey)&&a.length)return b(!0),i("",{action:"input-change"}),e.preventDefault(),void e.stopPropagation();if("Backspace"===e.key){if(e.metaKey||h)return b(!1),p([],"delete"),e.preventDefault(),void e.stopPropagation();e.ctrlKey&&i("",{action:"input-change"})}"Tab"===e.key&&(d(!e.shiftKey),e.preventDefault(),e.stopPropagation()),r(e)}),[h,r,f,p,a.length,i,d]),y=o.useCallback((()=>{b(!1),s&&s()}),[s,b]),C=o.useCallback((e=>{k(e),l&&l(e)}),[l,k]);return o.useEffect((()=>{b(!1)}),[n,b]),o.createElement(u.BardeenCommandInput,Object.assign({highlightAll:h||t,inputTokens:a,onClear:y,onInputTextChange:i,onKeyDown:v,onPaste:C,onTokensChange:p,pbHeaderProps:g},m))};const v=e=>{const{inputText:t,inputTokens:n,isExecutable:a,typeHint:s,onClear:i,onKeyDown:r,onMenuClose:u,onTokensChange:p,onInputTextChange:g}=e,m=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n}(e,["inputText","inputTokens","isExecutable","typeHint","onClear","onKeyDown","onMenuClose","onTokensChange","onInputTextChange"]),[{groups:h},{clearSuggestions:b}]=(0,d.nb)(),f=o.useRef(n),v=o.useRef(h),[x,T]=o.useState({}),[E,O]=o.useState(n),[I,M]=o.useState(h),[Z,A]=o.useState([]),[B,P]=o.useState([]),[R,j]=o.useState(""),D=o.useMemo((()=>Z.find((e=>e.argument.name===R))),[R,Z]),N=Z.length>0,L=o.useCallback((()=>{A([]),P([]),j(""),T({}),O([])}),[]),$=o.useCallback((e=>{b(),j(e),b();const t=C(B,e,Z);p(t,"append"),setTimeout((()=>{const t=x[e]||"";g(t,{action:"input-change"})}),0)}),[b,B,Z,p,x,g]),F=o.useCallback(((e=!0)=>{if(!R||Z.length<2)return;const t=Z.findIndex((e=>e.argument.name===R));if(-1===t)return;const n=w(t+(e?1:-1),Z.length);$(Z[n].argument.name)}),[R,Z,$]),H=o.useCallback(((e,t)=>{["set-value","input-change"].includes(t.action)&&("input-change"===t.action&&T(Object.assign(x,{[R]:e})),g(e,t))}),[g,x,R]);o.useEffect((()=>{const e=y(f.current),o=y(n);if(f.current=n,null==e&&null!=o){const e=function(e){var t,n;let o="";const a=[],s=[],i=[];if(!e.length)return{activeTab:o,currentTabTokens:a,commandArguments:s,rootTokens:i};const r=e.slice(),l=r.shift(),c=l.uiMeta;if(!c)return{activeTab:o,currentTabTokens:a,commandArguments:s,rootTokens:i};if("playbook"===c.type)c.arguments.forEach((e=>{s.push({argument:e,complete:!1,tokens:[]})})),o=null===(t=c.arguments[0])||void 0===t?void 0:t.name,i.push(l);else if(!c)return{activeTab:o,currentTabTokens:a,commandArguments:s,rootTokens:i};const u=(e,t)=>{const n=s.find((t=>t.argument.name===e));n&&(n.tokens=t)};let p=null,d=[];for(;r.length;){const e=r.shift();"playbook.argument"===(null===(n=e.uiMeta)||void 0===n?void 0:n.type)?(p&&d.length&&u(p.uiMeta.name,d),p=e,d=[]):p&&d.push(e)}p&&u(p.uiMeta.name,d);const g=s.find((e=>e.argument.name===o));return g&&a.push(...g.tokens),{activeTab:o,currentTabTokens:a,commandArguments:s,rootTokens:i}}(n);if(A(e.commandArguments),P(e.rootTokens),t.length>0){const n=(null==s?void 0:s.argName)||e.activeTab;j(n),T(Object.assign(x,{[n]:t}))}else j(e.activeTab);O(e.currentTabTokens)}else if(null==o&&null!=e)L();else if(N){const e=Z.find((e=>e.argument.name===R));(null==e?void 0:e.tokens)&&O(e.tokens)}else N||O(n)}),[L,n,N,s,t,x,Z,R]);const K=o.useCallback(((e,t)=>{if(N){const n=S(Z,R,{tokens:e});A(n);const o=C(B,R,n);p(o,t),T(Object.assign(x,{[R]:""}))}else p(e,t)}),[R,Z,N,p,x,B]),_=o.useCallback((e=>{const t=S(Z,e,{tokens:[],complete:!1});A(t);const n=C(B,R,t);p(n,"delete")}),[Z,B,R,p]),z=o.useCallback((()=>{L(),i&&i()}),[i,L]),V=o.useMemo((()=>{const e=y(n);if(!e)return;if(0===Z.length)return;const{color:t,name:o}=e.uiMeta.playbookMeta,a=(0,c.getPlaybookColorPair)(t);return{activeTab:R,color:a,name:o,tabs:Z,onTabChange:$,onArgumentDelete:_}}),[n,R,Z,$,_]),G=o.useMemo((()=>{const e=y(n);if(!e)return"";const t=e.uiMeta;return"playbook"===(null==t?void 0:t.type)?`${t.playbookMeta.id}-${R}`:""}),[n,R]);return o.useEffect((()=>{const t=e=>{l()(e,v.current)||(v.current=e,M(e))};if(N){let n=a;if(t(h.map((e=>(e.options.some((e=>0===e.nestingLevel))&&(n=!0),{icon:e.icon,label:e.label,options:e.options.filter((e=>0!==e.nestingLevel))}))).filter((e=>e.options.length>0))),e.isLoading)return;(null==D?void 0:D.tokens.length)||(n=!1),(null==D?void 0:D.complete)!=n&&A((e=>S(e,R,{complete:n})))}else t(h)}),[e.isLoading,R,D,a,N,v,h]),o.createElement(k,Object.assign({clipboardContext:G,completeChoice:!a&&(null==D?void 0:D.complete)?"visible":"hidden",inputSuggestionGroups:I,inputText:t,inputTokens:E,isExecutable:a&&""===t,onClear:z,onComplete:F,onKeyDown:r,onInputTextChange:H,onMenuClose:u,onTokensChange:K,onTabChange:F,pbHeaderProps:V},m))};function y(e){var t;return e&&e.length&&e[0].uiMeta&&"playbook"===(null===(t=e[0].uiMeta)||void 0===t?void 0:t.type)?e[0]:null}function C(e,t,n){const o=[];o.push(...e),n.forEach((e=>{e.argument.name!==t&&0!==e.tokens.length&&(o.push(...e.argument.prefixTokens),o.push(...e.tokens))}));const a=n.find((e=>e.argument.name===t));return o.push(...a.argument.prefixTokens),o.push(...a.tokens),o}const S=(e,t,n)=>e.map((e=>e.argument.name!==t?e:Object.assign(Object.assign({},e),n))),w=(e,t)=>(e%t+t)%t;class x extends o.Component{constructor(e){super(e),this.inputRef=o.createRef(),this.state={userInput:"",isOptionSelected:!1},this.handleStateChange=(e,t,n)=>{const{onInputStateChange:o,inputState:a}=this.props;o(Object.assign({},a,{tokens:e,userInput:t}),n)},this.handleInputChange=(e,t)=>{if(!this.props.typeHint&&"\n"===e)return;const{tokens:n}=this.props.inputState;this.setState({userInput:e}),"input-change"===t.action&&this.handleStateChange(n,e,"input")},this.handleTokensChange=(e,t)=>{this.handleStateChange(e,"","append"===t?"choice":"delete"),this.focus()},this.handleClear=e=>{this.setState({userInput:""}),this.handleStateChange([],"","delete"),null==e||e.preventDefault(),null==e||e.stopPropagation()},this.insertAtCursorPosition=e=>{const{inputState:t}=this.props,{userInput:n}=this.state,o=document.activeElement,a=o.selectionStart;this.setState({userInput:n.substr(0,a)+e+n.substr(a)},(()=>{this.handleStateChange(t.tokens,this.state.userInput,"input"),o.selectionStart=o.selectionEnd=a+1}))},this.handleKeyDown=e=>{const{onKeyDown:t}=this.props,{userInput:n}=this.state;if(n.length>0&&"Enter"===e.key&&e.shiftKey)return e.preventDefault(),e.stopPropagation(),void this.insertAtCursorPosition("\n");if("ArrowUp"===e.key){const{isSuggestionMenuVisible:t,onUpArrow:n}=this.props;n&&!t&&n()&&(e.preventDefault(),e.stopPropagation())}t&&t(e)},this.handleMenuOpen=()=>{this.props.onSuggestionMenuToggle(!0),this.props.isAppVisible&&this.focus()},this.handleMenuClose=()=>{this.state.isOptionSelected?this.setState({isOptionSelected:!1}):this.props.onSuggestionMenuToggle(!1)},this.handleOnFocus=()=>{const{onFocus:e}=this.props;e&&e()},this.handleOnBlur=()=>{const{onBlur:e}=this.props;e&&e()},this.handleSubmit=()=>{this.props.onSubmit(),this.props.onSuggestionMenuToggle(!1),this.setState({isOptionSelected:!1})}}focus(e=!1){setTimeout((()=>{var e;return null===(e=this.inputRef.current)||void 0===e?void 0:e.focus()}),100),e&&this.props.onSuggestionMenuToggle(!0)}UNSAFE_componentWillReceiveProps(e){const t=e.inputState.userInput;this.state.userInput!==t&&this.setState({userInput:t})}shouldComponentUpdate(e,t){return t.isOptionSelected!==this.state.isOptionSelected||t.userInput!==this.state.userInput||e.isLoading!==this.props.isLoading||e.isSuggestionMenuVisible!==this.props.isSuggestionMenuVisible||e.inputToolTip!==this.props.inputToolTip||e.inputState.userInput!==this.props.inputState.userInput||e.inputState.isExecutable!==this.props.inputState.isExecutable||e.commandInputType!==this.props.commandInputType||JSON.stringify(e.inputState.tokens)!==JSON.stringify(this.props.inputState.tokens)}render(){const{autoFocus:e,inputState:{tokens:t,isExecutable:n,typeHint:a},isLoading:s,isSuggestionMenuVisible:i,inputToolTip:r,commandInputType:l,collectTokens:c}=this.props,{userInput:u}=this.state;return o.createElement(v,{autoFocus:e,collectTokens:c,commandInputType:l,inputRef:this.inputRef,inputText:u,inputTokens:t||[],inputToolTip:r,isExecutable:n||!1,isLoading:s,isSuggestionMenuVisible:i,typeHint:a,onBlur:this.handleOnBlur,onClear:this.handleClear,onFocus:this.handleOnFocus,onInputTextChange:this.handleInputChange,onKeyDown:this.handleKeyDown,onMenuClose:this.handleMenuClose,onMenuOpen:this.handleMenuOpen,onSubmit:this.handleSubmit,onTokensChange:this.handleTokensChange})}}var T=function(e,t,n,o){return new(n||(n=Promise))((function(a,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}))};const E=o.memo((e=>{const{open:t,handleClose:n}=e,[a,i]=o.useState("notifications"),[{list:r},{dismissException:l,dismissAllExceptions:c,retryException:p,setNotifications:g}]=(0,d.ZP)((e=>e.notifications),(e=>e.notificationActions)),m=(0,u.useFullScreenContainerStyles)(),h=o.useCallback((e=>{a!==e&&i(e)}),[a]);return t?o.createElement("div",{className:m.wrapper},o.createElement(u.Header,{disabledClearAll:0===r.length,onClearAll:c,activeNav:a,handleNavChange:h,onClose:n}),o.createElement((()=>{switch(a){case"settings":return o.createElement(u.Settings,null);default:return o.createElement(u.Content,{list:r,onRetry:({id:e})=>T(void 0,void 0,void 0,(function*(){return g(yield p(e))})),onDismiss:({id:e})=>T(void 0,void 0,void 0,(function*(){return g(yield l(e))})),onSettingsRedirect:()=>s.Z.openSettings("errors")})}}),null)):null}));var O=n(26304);const I="ui:ignoredExecutionWarnings",M=e=>{const{open:t,playbookMeta:n,onConfirm:a}=e,i=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n}(e,["open","playbookMeta","onConfirm"]),[r,l]=o.useState(!1),c=o.useRef(!1),p=o.useCallback(((e,t)=>{t?function(e){return t=this,n=void 0,a=function*(){const t=yield Z();t.includes(e)||(t.push(e),yield s.Z.accountSettingsSet(I,t))},new((o=void 0)||(o=Promise))((function(e,s){function i(e){try{l(a.next(e))}catch(e){s(e)}}function r(e){try{l(a.throw(e))}catch(e){s(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,r)}l((a=a.apply(t,n||[])).next())}));var t,n,o,a}(e.id).finally((()=>{a(e)})):a(e)}),[a]);return o.useEffect((()=>{t!==c.current&&(c.current=t,t?Z().then((e=>{e.includes((null==n?void 0:n.id)||"")?n&&a(n):l(!0)})).catch((()=>{l(!0)})):l(!1))}),[t,n,a]),o.createElement(u.PlaybookExecutionWarningModal,Object.assign({open:r,onConfirm:p,playbookMeta:n},i))};function Z(){return s.Z.accountSettingsGet(I)}const A=u.MetricsMap.boxModel.spacing,B=u.MetricsMap.boxModel.zIndex,P=(0,a.Z)((e=>({"@global":{".popup-save-prompt":{background:u.ColorMap.base.white,padding:A.l,borderBottom:"solid 1px #f1f3f4",marginBottom:"10px"},".bardeen-trigger-group":{marginTop:A.base}},appWindow:{background:u.ColorMap.base.white,height:"100%",width:"100%"},bottomActions:{display:"flex",background:u.ColorMap.base.white,justifyContent:"center",padding:`${e.spacing(3)}px 0`,borderTop:"1px solid rgba(0, 0, 0, 0.02)",boxShadow:"0 -4px 12px rgba(0, 0, 0, 0.06)",backgroundClip:"padding-box","& > *:not(:first-child)":{marginLeft:".75rem"}},notebookUI:Object.assign(Object.assign({},u.column),{marginTop:"-25px",height:"calc(100% - 80px + 25px)"}),pbHeaderOn:{margin:0,height:"100%"},editableCommandsContent:{flex:1,overflowY:"scroll"},notebookUIFlex:{display:"flex",alignItems:"center",justifyContent:"space-between"},welcomeCardBtn:Object.assign(Object.assign({display:"inline-block"},(0,u.positionAbsolute)({top:"12px",right:"12px"})),{zIndex:1}),tabHeaderButton:{fontSize:u.MetricsMap.typography.size.base,lineHeight:u.MetricsMap.typography.lineHeight.l+"px",fontWeight:u.MetricsMap.typography.weight.normal,marginTop:-10,marginBottom:-10},tabHeaderFooter:Object.assign({},u.centerVert),bardeenSelect:{padding:"0 16px",zIndex:B.l},h100:{height:"100%"}}))),R=u.MetricsMap.boxModel.spacing,j=e=>{const t=N();return o.createElement("div",{className:(0,i.Z)(t.heading,e.className)},o.createElement("div",{className:t.headingInner},e.children))},D=R.base,N=(0,a.Z)((e=>({heading:{color:u.ColorMap.base[80],position:"sticky",top:`-${D}px`,zIndex:999,"&::before, &::after":{content:"''",display:"block",height:`${D}px`,position:"sticky"},"&::before":{top:56-D+"px",boxShadow:"0px 1px 2px rgb(0 0 0 / 16%)"},"&::after":{background:"linear-gradient(white 0%, rgba(255,255,255,0.4) 100%)",top:0,zIndex:2}},headingInner:{position:"sticky",height:56,padding:`${e.spacing(4.5)}px ${e.spacing(5)}px ${e.spacing(4.5)}px`,background:u.ColorMap.base.white,top:0,marginTop:`-${D}px`,zIndex:3}})));var L=function(e,t,n,o){return new(n||(n=Promise))((function(a,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}))};const $=["👨‍💻","👩‍💻"];var F;!function(e){e[e.Hidden=0]="Hidden",e[e.ToGreen=1]="ToGreen",e[e.ToGray=2]="ToGray"}(F||(F={}));const H={tokens:[],userInput:""},K=e=>{const t=o.useMemo((()=>new p),[]),[n,{getNotifications:a,setNotifications:r}]=(0,d.j1)((e=>e.notifications),(e=>e.notificationActions)),[,{setSuggestions:g,clearSuggestions:m}]=(0,d.nb)(),[{activeCommandsList:h,resultsList:k,isOpen:v,state:y},{addResult:C,setResults:S,setActiveCommands:w,removeCommand:T,setIsResultsOpen:I,updateProgress:Z,setResultsState:A}]=(0,d.mF)(),[,{openSnackbar:B,closeSnackbar:R}]=(0,d.E0)(),D=o.useRef(null),N=o.useRef(""),K=o.useRef(-1),_=o.useRef(!0),z=o.useRef(y),V=o.useRef([]),G=o.useRef(0),{appVisible:U,commandExecuted:W,openPlaybookBuilder:q,withHeader:J,timeSaved:Q}=e,[Y]=o.useState(0),[X,ee]=o.useState(""),[te,ne]=o.useState({open:!1,message:""}),[oe,ae]=o.useState(!1),[se,ie]=o.useState(!1),[re,le]=o.useState(!1),[ce,ue]=o.useState(!1),[pe,de]=o.useState(F.Hidden),[ge,me]=o.useState("ready"),[he,be]=o.useState([]),[fe,ke]=o.useState({tokens:[],userInput:""}),[ve,ye]=o.useState(null),[Ce,Se]=o.useState(void 0),[we,xe]=o.useState(null),[Te,Ee]=o.useState([]),[Oe,Ie]=o.useState(null),[Me,Ze]=o.useState(""),[Ae,Be]=o.useState(null),[Pe,Re]=o.useState((()=>()=>{})),[je,De]=o.useState(null),[Ne,Le]=o.useState(),[$e,Fe]=o.useState({email:"",profilePicture:"",userName:"",uuid:""}),[He,Ke]=(0,o.useState)({}),[_e,ze]=function(){const[e,t]=o.useState(!1),[n,a]=o.useState(),s=o.useRef(),i=o.useRef();return[o.useMemo((()=>({onCancel:()=>{i.current&&i.current()},onConfirm:()=>{s.current&&s.current()},playbookMeta:n,open:e})),[e,n]),o.useCallback((e=>e.warningMessage?new Promise((n=>{s.current=()=>{t(!1),n(!0)},i.current=()=>{t(!1),n(!1)},a(e),t(!0)})):Promise.resolve(!0)),[])]}(),[Ve,Ge]=o.useState(void 0),[Ue,We]=o.useState(),qe=o.useRef(!1),Je=o.useRef(fe),Qe=o.useRef(!1),Ye=o.useRef(!1);Qe.current=v,Ye.current=ce;const Xe=o.useMemo((()=>{if(U&&fe.tokens[0]){const e=fe.tokens[0];if(e.uiMeta&&"playbook"===e.uiMeta.type&&e.uiMeta.arguments)return Boolean(e.uiMeta.arguments.length)}return!1}),[U,fe.tokens]),et=P(),tt=!k.length&&!h.length,nt=(0,o.useCallback)(((e=!1)=>{var t;return null===(t=D.current)||void 0===t?void 0:t.focus(e)}),[]),ot=o.useCallback((()=>{if(!N.current)return;const e=N.current;return s.Z.progressiveDataCollect(N.current).then((t=>{if(e!==N.current)return;const n=t.data.filter((e=>{var t;return!(null===(t=e.children)||void 0===t?void 0:t.length)&&!e.label.startsWith("Value of '")}));if(t.completed)return g(n,"compose"),me("ready"),N.current="",void ae(!1);t.data.length>0&&(g(n,"compose"),me("ready")),setTimeout((()=>window.requestAnimationFrame(ot)),25)})).catch((()=>{}))}),[g]),at=(0,o.useCallback)((()=>N.current?s.Z.progressiveDataAbort(N.current):Promise.resolve()),[]),st=(0,o.useCallback)((()=>L(void 0,void 0,void 0,(function*(){yield at(),ae(!1),m()}))),[at,m]),it=(0,o.useCallback)((e=>{at(),N.current=e,ot()}),[at,ot]),rt=o.useCallback((()=>(ee(""),s.Z.notebookSelect("compose").then((e=>(ye(e),s.Z.notebookCommandAutoComplete(Je.current).then((e=>it(e.suggestionsDataSession)))))).catch((e=>{B({variant:"error",description:`Could not update notebook: ${(0,c.unknownToString)(e)}`})})))),[B,it]),lt=o.useCallback((()=>L(void 0,void 0,void 0,(function*(){const e=yield a(),t=e=>e.map((e=>e.id)).sort();l()(t(e),t(V.current))||(V.current=e,r(e))}))),[a,r]),ct=he.length>0,ut=(0,o.useCallback)((()=>(lt(),Promise.all([s.Z.triggersList(),s.Z.getCommandExecutionProgress(),s.Z.authGetStatus()]).then((e=>{(0!==e[0].length||ct)&&be(e[0]),Le(e[2]),-1===e[1]&&_.current&&(_.current=!1,rt())})))),[lt,ct,rt]),pt=o.useCallback(((e,n)=>{const o=!e.tokens.length&&!e.userInput,a=Je.current;Je.current=e,ke(e);const i=()=>(ae(!0),s.Z.notebookCommandAutoComplete({tokens:e.tokens,userInput:e.userInput}).then((e=>{ee(""),Se(e.typeHint);const t=Object.assign(Object.assign({},Je.current),{isExecutable:e.isExecutable||!1,typeHint:e.typeHint});Je.current=t,ke(t),it(e.suggestionsDataSession)})).catch((e=>(B({variant:"error",description:`Could not provide suggestions: ${(0,c.unknownToString)(e)}`}),st()))));if("choice"===n)return t.cancel(),i();const r=e.userInput.length<a.userInput.length||e.tokens.length<a.tokens.length||"delete"===n;if(r&&o)return je&&je([]),t.cancel(),i();r&&""===a.userInput&&Se(void 0),t.debounce(i,r)}),[t,it,B,st,je]),dt=o.useCallback((()=>{s.Z.notebookReset().then((()=>L(void 0,void 0,void 0,(function*(){S([]),ee("")})))).catch((e=>{ee((0,c.unknownToString)(e))}))}),[S]),gt=o.useCallback((()=>{ue(!1)}),[]),mt=o.useCallback((()=>{ue(!0)}),[]),ht=o.useCallback((()=>{de(F.Hidden),I(!0),A(O.wF.all),z.current=O.wF.all}),[I,A]),bt=o.useCallback((()=>{z.current===O.wF.progress?de(F.ToGreen):de(F.ToGray),I(!1),A(O.wF.all),z.current=O.wF.all,Ve&&Ge(void 0)}),[Ve,I,A]),ft=o.useCallback((e=>L(void 0,void 0,void 0,(function*(){S(e.entries.reverse());const t=yield s.Z.notebookInspectContext(),n=e.entries.length>0?null==we?void 0:we.getMeta():void 0,o=u.PlaybookTransformState.fromInspection(t,xe,n);xe(o)}))),[we,S]),kt=o.useCallback(((e,t)=>o.createElement(b,{blocks:e.blocks,isLast:t,entry:e,onNotebookChanged:ft,onCloseResultsScreen:bt,onRepeat:()=>{bt(),s.Z.notebookCommandRecall(e.uuid).then((e=>{nt(!0),pt(e),m()}))}})),[m,bt,nt,pt,ft]),vt=o.useCallback((()=>(at(),Je.current=H,ke(H),Se(void 0),s.Z.notebookCommandAutoComplete(H).then((e=>{it(e.suggestionsDataSession),Se(e.typeHint)})).catch((e=>{B({variant:"error",description:`Could not auto-complete input: ${(0,c.unknownToString)(e)}`})})),s.Z.notebookCommandHandle(fe).then((e=>{ee("");const t=n=>{n.uuid===e.uuid&&(s.Z.off("command_completed",t),s.Z.dedangle(s.Z.notebookGetActive().then((()=>{W(),je&&je(fe.tokens)}))))};s.Z.on("command_completed",t)})).catch((e=>{je&&je(Promise.reject(e)),B({variant:"error",description:`Could not execute your request: ${(0,c.unknownToString)(e)}`})})))),[at,fe,W,je,B,it]),yt=o.useCallback((e=>s.Z.notebookVisualBlockInteract(e)),[]),Ct=o.useCallback((e=>L(void 0,void 0,void 0,(function*(){const t=yield s.Z.notebookCommandRecall(e),n=yield s.Z.notebookCommandHandle(t);ee("");const o=e=>{e.uuid===n.uuid&&(s.Z.off("command_completed",o),s.Z.dedangle(s.Z.notebookGetActive().then((e=>S(e.entries.reverse())))))};s.Z.on("command_completed",o)}))),[S]),St=o.useCallback((()=>{const e=null==ve?void 0:ve.entries.length;if(e&&!fe.userInput&&!fe.tokens.length){const t=ve.entries[e-1];return s.Z.notebookCommandRecall(t.uuid).then((e=>(m(),pt(e)))).catch((e=>{B({variant:"error",description:`Could not recall last command: ${(0,c.unknownToString)(e)}`})})),!0}return!1}),[m,fe.tokens.length,fe.userInput,pt,B,ve]),wt=o.useMemo((()=>{const e=null!=Ne&&Ne.entries&&Ne.entries.length>0,t={onCancel:s.Z.authCancel,onContinue:s.Z.authContinue,onExecuteOne:s.Z.authContinueOne,onFocusActive:s.Z.authFocusActive,popupMode:!0,status:Ne,visible:se};if(e)t.visible=!0;else if(se&&Oe){const e={headerText:Oe.name,headerColor:(0,c.getPlaybookColorPair)(Oe.color),headerIcon:{icon:"PlaybookBold"},icon:{icon:"TexturedMagnet"},title:"Connect applications",subtitle:"To run this playbook, please connect the following applications:",userData:{op:Me,meta:Oe,lazy:Ae},postAuthAction:"close",postAuthMessage:"Your selected playbook will be executed automatically."};t.status={auto:!1,entries:Te.map((e=>({icon:e.icon,active:!1,completed:!1,name:e.name,error:null}))),meta:e},t.onCancel=()=>{ie(!1),Pe(!1)},t.onContinue=()=>{s.Z.integrationsActivateMany(Te.map((e=>e.id)),e).then((e=>{Pe(!e.aborted),ie(!1)})).catch((()=>{ie(!1),Pe(!1)})).finally((()=>{s.Z.integrationsResetLastStatus(),Le(void 0)}))}}return o.createElement(u.ConnectApplicationsCardModal,Object.assign({},t))}),[Ne,se,Oe,Me,Ae,Te,Pe]),xt=o.useMemo((()=>{if(!Ce)return"";if(Ce.argDescription)return"Specify "+Ce.argDescription[0].toLowerCase()+Ce.argDescription.substr(1);let e="Specify a";return/^[aeiou]/.exec(Ce.argName)&&(e+="n"),`${e} ${Ce.argName}`}),[Ce]),Tt=o.useCallback(((e,t)=>L(void 0,void 0,void 0,(function*(){try{const n=e.id,o=yield s.Z.playbookGetDependencies(n);return!o.missingPlugins.length||(ne({open:!1,message:""}),Ze(t),Ie(e),Ee(o.missingPlugins),ie(!0),new Promise((e=>{Re((()=>e))})))}catch(e){return B({variant:"error",description:`Could not query playbook dependencies: ${(0,c.unknownToString)(e)}`}),!1}}))),[B]),Et=(0,o.useCallback)(((e,t)=>L(void 0,void 0,void 0,(function*(){if(e.hasArguments){const{invokeTokens:t}=e;return ne({open:!1,message:""}),nt(!0),m(),pt({tokens:t,userInput:""}),new Promise((e=>{De((()=>e))})).then((e=>{De(null),JSON.stringify(e[0]),JSON.stringify(t[0])}))}if(!e.warningMessage||t||(yield ze(e)))return s.Z.playbookRun(e.id).then((e=>{ee("");const t=n=>{n.uuid===e.uuid&&(s.Z.off("command_completed",t),s.Z.dedangle(s.Z.notebookGetActive().then((e=>{ye(e)}))))};s.Z.on("command_completed",t)})).catch((e=>{ee((0,c.unknownToString)(e))}))}))),[m,ze,nt,pt]),Ot=(0,o.useCallback)((()=>0===k.length?o.createElement(u.BardeenEmptyMessage,{title:"Compose a command",icons:$},"To learn how to run custom commands in Bardeen, follow this link to our Learning Center"," ",o.createElement("a",{href:"https://www.bardeen.ai/lessons/commands",target:"_blank"},"Guide to composing commands"),"."):o.createElement("div",{className:"bardeen-compose-group",style:{paddingRight:15,paddingLeft:15,paddingTop:0}},o.createElement(f,{changeIndicator:Y,entries:k,onNotebookChanged:ft,onInputStateChanged:e=>{nt(!0),pt(e),m()}}))),[k,Y,ft,nt,pt,m]),It=o.useCallback(((e,t)=>o.createElement(f,{isDark:t,changeIndicator:Y,entries:e,onNotebookChanged:ft,onInputStateChanged:e=>{nt(!0),pt(e),m()},closeResults:bt})),[Y,ft,bt,nt,pt,m]),Mt=e=>{de(F.Hidden),I(!0),A(O.wF.progress),z.current=O.wF.progress,w([e])},Zt=o.useRef(Date.now()),At=e=>{const t=Date.now();t-Zt.current<500||(Z(e.uuid,e),Zt.current=t)},Bt=(e,t,n)=>{var o;if(T(e.uuid),!t||n)return Pt();if(C(t),Ge(t),!e.aborting&&z.current===O.wF.progress){const e=(null===(o=null==t?void 0:t.blocks)||void 0===o?void 0:o[0])||{},n="status"in e&&"failure"===e.status||"status"in e&&"no-data"===e.status;A(n?O.wF.latest:O.wF.all),z.current=n?O.wF.latest:O.wF.all}},Pt=()=>L(void 0,void 0,void 0,(function*(){const e=yield s.Z.notebookGetActive();S(e.entries.reverse())})),Rt=o.useCallback((e=>{s.Z.dedangle(s.Z.progressCancel(e).then((()=>{T(e)})))}),[T]),jt=o.useCallback(((e,t)=>Tt(e,"pinned-invoke").then((n=>{if(n)return Et(e,t)})).catch((e=>{B({variant:"error",description:`Error invoking: ${(0,c.unknownToString)(e)}`})}))),[B,Et,Tt]),Dt=o.useCallback((e=>L(void 0,void 0,void 0,(function*(){var t,n;if(e.playbookMeta&&e.playbookMeta.warningMessage){if(!(yield ze(e.playbookMeta)))return[];if(0===fe.tokens.length&&0==e.playbookMeta.argdef.length)return jt(e.playbookMeta,!0),[]}if(!e.lazy)return e.tokens;let o=Promise.resolve(!0);return((null===(t=e.lazy.requires)||void 0===t?void 0:t.plugins)||[]).length&&(Be(e.lazy),o=Tt(null===(n=e.lazy.requires)||void 0===n?void 0:n.playbook,"prefill-invoke")),o.then((t=>t?s.Z.notebookCommandEvaluateLazySuggestion(e.lazy,fe).then((e=>e.tokens)):[])).catch((()=>[]))}))),[fe,ze,jt,Tt]),Nt=o.useCallback((e=>{"Enter"===e.key&&"ready"!==ge&&e.preventDefault(),(String.fromCharCode(e.keyCode).match(/(\w|\s)/g)||"Backspace"===e.key)&&me("suggestions-outdated")}),[me,ge]);(0,u.useEffectOnce)((()=>(s.Z.dedangle(L(void 0,void 0,void 0,(function*(){const e=yield s.Z.progressListActiveCommands();e.length>0&&w(e)}))),s.Z.dedangle(Pt()),s.Z.on("command_completed",Bt),s.Z.on("command_progress",At),s.Z.on("command_started",Mt),()=>{s.Z.off("command_completed",Bt),s.Z.off("command_progress",At),s.Z.off("command_started",Mt)})));const Lt=o.useCallback((()=>o.createElement(o.Fragment,null,Ot(),o.createElement("div",{style:{marginTop:"16px"}}))),[Ot]),$t=o.useCallback(((e,t)=>s.Z.systemSettingSet(e,t).then(Ke)),[]),Ft=o.useCallback((()=>{s.Z.dedangle(s.Z.appWindowHide().then((()=>{window.close()})))}),[]),Ht=()=>{B({variant:"warning",message:"Please check your internet connection.",autoHide:!1})};(0,u.useKeyboardHandler)((()=>{switch(!0){case Qe.current:return bt();case Ye.current:return gt();case Boolean(Je.current.userInput)||Je.current.tokens.length>0:return pt(Object.assign({},Je.current,{tokens:[],userInput:""}),"delete");default:return Ft()}}),["Escape"]),o.useEffect((()=>{rt()}),[rt]),(0,u.useEffectOnce)((()=>(ut(),window.clearInterval(K.current),K.current=window.setInterval(ut,500),s.Z.systemSettingsGet().then(Ke),s.Z.systemBardeenAccountProfileGet().then(Fe),()=>{window.clearInterval(K.current)}))),(0,o.useEffect)((()=>{U!==qe.current&&(qe.current=U,U?s.Z.dedangle(L(void 0,void 0,void 0,(function*(){yield nt(),yield s.Z.appWindowEvent("app_shown")}))):s.Z.appWindowEvent("app_hidden"))}),[U,nt]);const Kt=()=>{Ge(void 0)};o.useEffect((()=>{if(Ve)return G.current=window.setTimeout((()=>{Kt()}),1e4),()=>{G.current=0,clearTimeout(G.current)}}),[Ve]),(0,u.useEffectOnce)((()=>(window.navigator.onLine||Ht(),window.addEventListener("online",R),window.addEventListener("offline",Ht),()=>{window.removeEventListener("online",R),window.removeEventListener("offline",Ht)}))),(0,u.useEffectOnce)((()=>()=>I(!1)));const _t=o.useMemo((()=>J&&!Xe?o.createElement(u.PopupHeader,{icon:"./icons/bardeen-transparent.png",account:$e,settings:He,timeSaved:Q,settingsButtonAction:s.Z.openSettings,resultsButtonAction:ht,notificationButtonAction:mt,disabledNotifications:!n.list.length,disabledResults:tt,result:Ve,resultLoading:h.length>0,updateContextSettings:$t,handleResultNotificationClose:Kt,handleOpenPlaybookBuilder:()=>q(!0),handleResultScreenOpen:()=>{I(!0),Kt()}}):null),[h,J,Xe,$e,He,Q,ht,q,mt,n.list.length,tt,$t,Ve,I]);return o.createElement("div",{className:et.appWindow,ref:We},_t,o.createElement("div",{className:(0,i.Z)(et.notebookUI,{[et.pbHeaderOn]:Xe})},o.createElement("div",{className:(0,i.Z)(et.bardeenSelect,{[et.h100]:re})},o.createElement(x,{ref:D,collectTokens:Dt,commandInputType:"compose",inputState:fe,inputToolTip:xt,isLoading:oe,isSuggestionMenuVisible:re,onInputStateChange:pt,onKeyDown:Nt,onSubmit:vt,onSuggestionMenuToggle:le,onUpArrow:St,typeHint:Ce,isAppVisible:U})),X?o.createElement(u.BardeenAlert,{severity:"error"},X):null,re?null:o.createElement(u.BardeenTabs,{activeTab:"actions",onTabChange:()=>{},hideTabBar:!0,tabs:[{key:"actions",title:o.createElement("span",{style:{color:u.ColorMap.bardeen[50]}},"Compose"),content:o.createElement(u.BardeenTabsPane,{key:"actions"},o.createElement(j,null,o.createElement("div",{className:et.notebookUIFlex},o.createElement("div",null,o.createElement(u.Title,{variant:"h4"},"Notebook")," "),o.createElement("div",null,o.createElement(u.BardeenIconButton,{tooltip:"Clear",TooltipProps:{placement:"bottom"},className:et.tabHeaderButton,type:"neumorphFlat",size:"l",icon:{icon:"TrashBinOutline"},onClick:dt})))),Lt())}]}),wt,o.createElement(u.BardeenScreenCollapseAnimation,{relativeTo:Ue,targetSelector:"#btn-results",visible:pe!=F.Hidden,zIndex:999}),v?o.createElement(u.ResultsScreen,{activeAppTab:"actions",activeCommands:h,entries:k,state:y,renderEntry:kt,renderGroup:It,handleRetry:Ct,handleInteract:yt,onClear:dt,onClose:bt,onCancel:Rt}):null,o.createElement(M,Object.assign({},_e)),o.createElement(E,{open:ce,handleClose:gt}),o.createElement(u.BardeenBackdrop,{open:re}),te.open?o.createElement(u.LoadingOverlay,{message:te.message}):null))};var _=n(28871),z=n(50405),V=function(e,t,n,o){return new(n||(n=Promise))((function(a,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}))};const G=e=>{const{appVisible:t}=e,[n,a]=o.useState(0),[i,r]=o.useState(!0),l=o.useCallback((()=>V(void 0,void 0,void 0,(function*(){s.Z.playbookEditorCanvasGet().then((()=>{u.app.dispatch({type:"BuilderOpen"})})).catch((()=>{u.app.dispatch({type:"BuilderOpenWithNewPlaybook"})})),r(!0)}))),[]);(0,u.useKeyboardHandler)((e=>{e.preventDefault(),e.stopPropagation(),r(!1)}),["Alt+KeyO"]);const p=()=>V(void 0,void 0,void 0,(function*(){a(yield s.Z.getTimeSaved())}));(0,u.useEffectOnce)((()=>{p()}));const d=U();return i?o.createElement(u.AppContainer,{api:s.Z}):o.createElement("div",{className:d.popupContainer,tabIndex:0,"data-bardeen-dismiss":!0},o.createElement("div",{className:d.popup,tabIndex:0},o.createElement(z._,null,o.createElement(K,{appVisible:t,commandExecuted:()=>{p()},timeSaved:(0,c.timeSavedFormatted)(n),openPlaybookBuilder:l,withHeader:!0}),o.createElement(_.B,null))))},U=(0,a.Z)((e=>({popupContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},popup:{borderRadius:e.spacing(3),display:"flex",height:640,width:640,position:"relative",overflow:"hidden",zIndex:1}})))},25038:(e,t,n)=>{n.d(t,{N:()=>a}),n(68796),n(13966),n(34073);var o=n(55567);const a={sessionActions:{setSession:(e,t)=>{const{state:n}=e;e.setState(Object.assign(Object.assign({},n),t))}},notificationActions:{setNotifications:(e,t)=>{const{state:n}=e;e.setState(Object.assign(Object.assign({},n),{notifications:Object.assign(Object.assign({},n.notifications),{list:t})}))},getNotifications:()=>o.Z.exceptionList(),retryException:(e,t)=>{return n=void 0,a=void 0,i=function*(){return o.Z.exceptionRecover(t)},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{l(i.next(e))}catch(e){t(e)}}function r(e){try{l(i.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(o,r)}l((i=i.apply(n,a||[])).next())}));var n,a,s,i},dismissException:(e,t)=>o.Z.exceptionDismiss(t),dismissAllExceptions:()=>o.Z.exceptionDismissAll()}}},34073:(e,t,n)=>{n(68796)},26304:(e,t,n)=>{var o;n.d(t,{wF:()=>o,r_:()=>s,Qx:()=>a}),n(68796),function(e){e.progress="progress",e.latest="latest",e.all="all"}(o||(o={}));const a={isOpen:!1,state:o.all,resultsList:[],activeCommandsList:[]},s={setResults:(e,t)=>{0===t.length&&e.setState(Object.assign(Object.assign({},e.state),{resultsList:[]})),e.setState(Object.assign(Object.assign({},e.state),{resultsList:t}))},addResult:(e,t)=>{e.setState(Object.assign(Object.assign({},e.state),{resultsList:[t,...e.state.resultsList]}))},setActiveCommands:(e,t)=>{e.setState(Object.assign(Object.assign({},e.state),{activeCommandsList:t}))},removeCommand:(e,t)=>{e.setState(Object.assign(Object.assign({},e.state),{activeCommandsList:e.state.activeCommandsList.filter((e=>e.uuid!==t))}))},setIsResultsOpen:(e,t)=>{e.setState(Object.assign(Object.assign({},e.state),{isOpen:t}))},updateProgress:(e,t,n)=>{e.setState(Object.assign(Object.assign({},e.state),{activeCommandsList:e.state.activeCommandsList.map((e=>e.uuid===t?n:e))}))},setResultsState:(e,t)=>{e.setState(Object.assign(Object.assign({},e.state),{state:t}))}}},29236:(e,t,n)=>{n.d(t,{N:()=>a,A:()=>o});const o={isOpen:!1,variant:"info",message:"",description:"",autoHide:!0},a={openSnackbar:(e,t)=>{var n;e.setState({isOpen:!0,variant:t.variant||"info",message:t.message||"",description:t.description||"",autoHide:null===(n=t.autoHide)||void 0===n||n})},closeSnackbar:e=>{e.setState({isOpen:!1,message:"",description:"",variant:"info",autoHide:!0})}}},32384:(e,t,n)=>{n.d(t,{n:()=>o}),n(13966);const o={session:null,playbooks:{list:[]},results:{list:[]},notifications:{list:[]}}},13966:(e,t,n)=>{n(68796)},7905:(e,t,n)=>{n.d(t,{_:()=>r,M:()=>o});const o={list:[],groups:[],commandInputType:"compose"};var a=n(68796);const s={"":{icon:null,label:"Default",weight:{compose:0,playbook:0,trigger:0}},exact:{icon:null,label:"Exact Match",weight:{compose:0,playbook:0,trigger:0}},notification:{icon:null,label:"Notification",weight:{compose:10,playbook:10,trigger:10}},operator:{icon:{icon:"CrossBold"},label:"Operator",weight:{compose:20,playbook:20,trigger:20}},playbook:{icon:{icon:"StarBold"},label:"Pinned Playbooks",weight:{compose:70,playbook:60,trigger:60}},"playbook-suggestion":{icon:{icon:"StarBold"},label:"Suggested Playbooks",weight:{compose:80,playbook:70,trigger:70}},value:{icon:{icon:"OverflowVerticalBold"},label:"Value",weight:{compose:50,playbook:50,trigger:50}},command:{icon:{icon:"PaperplaneBold"},label:"Command",weight:{compose:60,playbook:80,trigger:80}},"not-installed":{icon:{icon:"WebsiteOutline"},label:"Not installed",weight:{compose:100,playbook:100,trigger:100}},"arg-required":{icon:{icon:"RadioInfoBold"},label:"Required Arguments",weight:{compose:30,playbook:30,trigger:30}},"arg-optional":{icon:{icon:"RadioInfoBold"},label:"Optional Arguments",weight:{compose:40,playbook:40,trigger:40}}};function i(e,t){if(0===e.length)return[];const n=[],o={};return e.forEach((e=>{const t=e.group||a.SuggestionGroup.Default;let s=o[t];s||(s=o[t]=[],n.push(t)),s.push(e)})),n.sort(((e,n)=>s[e].weight[t]-s[n].weight[t])),n.map((e=>{const t=s[e],n=o[e].sort(((e,t)=>e.weight-t.weight));return{icon:t.icon,label:t.label,options:n}}))}const r={clearSuggestions:e=>{e.setState(Object.assign(Object.assign({},e.state),{list:[],groups:[]}))},setSuggestions:(e,t,n)=>{const o=t.map((e=>(e.__key=function(e){return e.deduplicationKey||`${e.label}:${e.description}`}(e),e)));return e.setState(Object.assign(Object.assign({},e.state),{list:o,groups:i(o,n)}))}}}}]);